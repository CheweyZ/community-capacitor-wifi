{"version":3,"file":"plugin.js","sources":["../build/electron/src/index.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst os_1 = require(\"os\");\r\nconst child_process_1 = require(\"child_process\");\r\nconst nodeWifi = require('node-wifi');\r\nclass Network {\r\n}\r\nclass Wifi {\r\n    constructor() {\r\n        nodeWifi.init({\r\n            iface: null,\r\n        });\r\n    }\r\n    async getIP() {\r\n        var ifs = os_1.default.networkInterfaces();\r\n        var ip = Object.keys(ifs)\r\n            .map(x => ifs[x].filter((x) => x.family === 'IPv4' && !x.internal)[0])\r\n            .filter(x => x)[0].address;\r\n        return { ip };\r\n    }\r\n    async getSSID() {\r\n        return new Promise(async (resolve, reject) => {\r\n            const currentConnections = await nodeWifi.getCurrentConnections().catch(() => []);\r\n            if (currentConnections && currentConnections[0]) {\r\n                resolve({ ssid: currentConnections[0].ssid });\r\n            }\r\n            else {\r\n                reject('ERROR_NO_NETWORK_FOUND');\r\n            }\r\n        });\r\n    }\r\n    async connect(options) {\r\n        await nodeWifi.connect(options);\r\n        return this.checkConnection();\r\n    }\r\n    async connectPrefix(options) {\r\n        let currentNetwork;\r\n        if (process.platform === 'win32') {\r\n            currentNetwork = await this.getSSID().catch(() => ({ ssid: null }));\r\n            await nodeWifi.disconnect().catch();\r\n            await this.timeout(2000);\r\n        }\r\n        const networks = await nodeWifi.scan().catch(() => []);\r\n        if (process.platform === 'win32') {\r\n            await this.reconnect(currentNetwork.ssid).catch();\r\n        }\r\n        const filteredNetworks = networks.filter((val) => { var _a; return (_a = val.ssid) === null || _a === void 0 ? void 0 : _a.startsWith(options.ssid); });\r\n        if (filteredNetworks.length === 0) {\r\n            throw new Error('ERROR_NO_NETWORK_FOUND');\r\n        }\r\n        else {\r\n            const network = await this.insertSelect(filteredNetworks);\r\n            if (!network) {\r\n                throw new Error('ERROR_NO_WIFI_SELECTED');\r\n            }\r\n            else {\r\n                options.ssid = network.ssid;\r\n                await nodeWifi.connect(options);\r\n                return this.checkConnection();\r\n            }\r\n        }\r\n    }\r\n    async disconnect() {\r\n        await nodeWifi.disconnect();\r\n    }\r\n    async checkConnection(retry = 10) {\r\n        let result;\r\n        let count = 0;\r\n        while (!result && count < retry) {\r\n            count++;\r\n            result = await this.getSSID().catch(() => null);\r\n            await this.timeout(1000);\r\n        }\r\n        if (!result) {\r\n            throw new Error('ERROR_FAILED_TO_CONNECT');\r\n        }\r\n        else {\r\n            return result;\r\n        }\r\n    }\r\n    timeout(millis) {\r\n        return new Promise(async (resolve) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, millis);\r\n        });\r\n    }\r\n    insertSelect(networks) {\r\n        return new Promise(async (resolve) => {\r\n            let htmlString = '<dialog id=\"wifiDialog\" open style=\"transition: opacity 0.2s ease-in-out; opacity: 0; z-index: 2000;width: 300px;top: 50%; transform: translateY(-50%); max-height: 80vh; overflow-y: auto; box-shadow: 0px 10px 18px #888888; border: none; border-radius: 5px\"><form method=\"dialog\">';\r\n            for (const network of networks) {\r\n                htmlString += `<button id=\"${network.ssid}\" value=\"${network.ssid}\" style=\"width: 100%; padding: 5px; font-size: 15px; margin-bottom: 5px;\">${network.ssid}</button>`;\r\n            }\r\n            htmlString += '</form></dialog';\r\n            document.body.insertAdjacentHTML('beforeend', '<div id=\"wifiBackdrop\" style=\"transition: opacity 0.2s ease-in-out; opacity: 0; height: 100vh; width: 100vw; background-color: grey;\"></div>');\r\n            document.body.insertAdjacentHTML('beforeend', htmlString);\r\n            const backdropEl = document.getElementById('wifiBackdrop');\r\n            const dialogEL = document.getElementById('wifiDialog');\r\n            await this.timeout(1);\r\n            backdropEl.style.opacity = '0.5';\r\n            dialogEL.style.opacity = '1';\r\n            for (const network of networks) {\r\n                const networkEl = document.getElementById(network.ssid);\r\n                networkEl.addEventListener('click', async () => {\r\n                    backdropEl.style.opacity = '0';\r\n                    dialogEL.style.opacity = '0';\r\n                    await this.timeout(200);\r\n                    backdropEl.remove();\r\n                    dialogEL.remove();\r\n                    resolve(network);\r\n                });\r\n            }\r\n            backdropEl.addEventListener('click', async () => {\r\n                backdropEl.style.opacity = '0';\r\n                dialogEL.style.opacity = '0';\r\n                await this.timeout(200);\r\n                backdropEl.remove();\r\n                dialogEL.remove();\r\n                resolve(null);\r\n            });\r\n        });\r\n    }\r\n    async reconnect(ssid) {\r\n        return new Promise(async (resolve, reject) => {\r\n            const env = Object.assign(process.env, {\r\n                LANG: 'en_US.UTF-8',\r\n                LC_ALL: 'en_US.UTF-8',\r\n                LC_MESSAGES: 'en_US.UTF-8'\r\n            });\r\n            child_process_1.default.execFile('netsh', ['wlan', 'connect', 'ssid=\"' + ssid + '\"', 'name=\"' + ssid + '\"'], { env, shell: true }, (err, stdout, stderr) => {\r\n                if (err) {\r\n                    // Add command output to error, so it's easier to handle\r\n                    err.stdout = stdout;\r\n                    err.stderr = stderr;\r\n                    reject(err);\r\n                }\r\n                else {\r\n                    resolve(stdout);\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\nexports.Wifi = Wifi;\r\n//# sourceMappingURL=index.js.map"],"names":["require$$0","require$$1","require$$2"],"mappings":"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"}